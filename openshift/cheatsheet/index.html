<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="generator" content=
  "HTML Tidy for HTML5 for Linux version 5.2.0">
  <meta charset="utf-8">
  <meta name="viewport" content=
  "width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>OpenShift CheatSheet</title>
  <link rel="stylesheet" href=
  "https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
  integrity=
  "sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
  crossorigin="anonymous">
  <link rel="stylesheet"
        href="style.css"/>
  <link rel="manifest" href="manifest.webmanifest">
</head>
<body>
  <script>
    if('serviceWorker' in navigator) {
      window.addEventListener('load', function(){
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => {
            console.log('Service worker registered! ðŸ˜Ž', reg);
          }).catch(err => {
            console.log('ðŸ˜¥ Service worker registration failed: ', err);
          });
      });
    }
  </script>
  <div class="container">
    <h1 class="header" id="header">OpenShift CheatSheet</h1>
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Installation</h2>
        <div class="card-text">
          <p>The client should be installed from the openshift client github repository.</p>
          <a href="https://github.com/openshift/origin/releases">https://github.com/openshift/origin/releases</a>
          <p>Check for the latest version, download it and extract it into your &tilde;/bin directory.</p>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">General</h2>
        <div class="card-text">
          <dl>
            <dt><code>oc login</code></dt>
            <dd>Login to OpenShift</dd>
            <dt><code>oc whoami</code></dt>
            <dd>Get your openshift username</dd>
            <dt><code>oc whoami -t</code></dt>
            <dd>Get your openshift bearer/session-token. It is valid for 24 hours.</dd>
            <dt><code>oc projects</code></dt>
            <dd>List available projects</dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Concepts</h2>
        <div class="card-text">
          <h3>Headless Service</h3>
          <p>A service without an assigned cluster ip-address.</p> It is created like a normal service except that the cluster ip is set to <code>"None"</code>.
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Object Types</h2>
        <div>
          <table class="table">
            <thead>
              <tr>
                <th scope="row">Object Type</th>
                <th scope="row">Abbreviation</th>
                <th scope="row">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>build</td>
                <td></td>
                <td>The process of transforming input parameters into
                a resulting object. Most often, builds are used to
                transform source code into a runnable container
                image.</td>
              </tr>
              <tr>
                <td>buildConfig</td>
                <td>bc</td>
                <td>A build configuration, or BuildConfig, is
                characterized by a build strategy and one or more
                sources. The strategy determines the aforementioned
                process, while the sources provide its input.</td>
              </tr>
              <tr>
                <td>deploymentConfig</td>
                <td>dc</td>
                <td></td>
              </tr>
              <tr>
                <td>imageStream</td>
                <td>is</td>
                <td></td>
              </tr>
              <tr>
                <td>imageStreamTag</td>
                <td>istag</td>
                <td></td>
              </tr>
              <tr>
                <td>imageStreamImage</td>
                <td>isimage</td>
                <td></td>
              </tr>
              <tr>
                <td>event</td>
                <td>ev</td>
                <td></td>
              </tr>
              <tr>
                <td>node</td>
                <td></td>
                <td></td>
              </tr>
              <tr>
                <td>pod</td>
                <td>po</td>
                <td></td>
              </tr>
              <tr>
                <td>replicationController</td>
                <td>rc</td>
                <td></td>
              </tr>
              <tr>
                <td>service</td>
                <td>svc</td>
                <td></td>
              </tr>
              <tr>
                <td>persistentVolume</td>
                <td>pv</td>
                <td></td>
              </tr>
              <tr>
                <td>persistentVolumeClaim</td>
                <td>pvc</td>
                <td></td>
              </tr>
            </tbody>
          </table>
      </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Pod management</h2>
        <div class="card-text">
          <dl>
            <dt><code>oc get pods</code></dt>
            <dd>Get a list of pods in the project</dd>
            <dt><code>oc edit pod &lt;podname&gt;</code></dt>
            <dd>Edit the pod <em>&lt;podname&gt;</em></dd>
            <dt><code>oc debug &lt;podname&gt;</code></dt>
            <dd>Start pod <em>&lt;podname&gt;</em> in debug mode</dd>
            <dt><code>oc logs &lt;podname&gt; --tail==&lt;number-of-lines&gt;</code></dt>
            <dd>Get the last <em>&lt;number-of-lines&gt;</em> lines of logs from pod <em>&lt;podname&gt;</em></dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Cronjobs</h2>
        <div class="card-text">
          <dl>
            <dt><code>oc get cronjob</code></dt>
            <dd>List cronjobs in current project</dd>
            <dt><code>oc edit cronjob &lt;cronjobname&gt;</code></dt>
            <dd>Edit the cronjob <em>&lt;cronjobname&gt;</em></dd>
            <dt><code>oc delete cronjob &lt;cronjobname&gt;</code></dt>
            <dd>Deletes the cronjob <em>&lt;cronjobname&gt;</em></dd>
            <dt><code>oc create job --from=cronjob/&lt;cornjobname&gt; &lt;name of job&gt;</code></dt>
            <dd>Runs cronjob pod <em>&lt;cronjobname&gt;</em> with the name <em>&lt;name of job&gt;</em> right now</dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Storage</h2>
        <div class="card-text">
          <dl>
            <dt><code>oc get pvc</code></dt>
            <dd>Show persistent volume (PV) claims</dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Networking</h2>
        <div class="card-text">
          <p>The capabilities of OpenShift's builtin Router are extremely limited. All it can do is basically define a hostname for a service and add ssl (https) encryption to the connection. Any additional router tasks need to be handeled by a separate proxy/router/waf-pod.</p>
          <dl>
            <dt><code>oc expose service &lt;service-name&gt;</code></dt>
            <dd>Creates a route to the service &lt;service-name&gt;</dd>
            <dt><code>oc get routes</code></dt>
            <dd>List all routes in the project</dd>
            <dt><code>oc get route &lt;route-name&gt; -o json</code></dt>
            <dd>Get the configuration of the route <em>&lt;route-name&gt;</em> in json format.</dd>
            <dt><code>oc edit route &lt;route-name&gt;</code></dt>
            <dd>Edit route <em>&lt;route-name&gt;</em>. <em>The host name of a route cannot be changed once it is set.</em></dd>
            <dt><code>oc delete route &lt;route-name&gt;</code></dt>
            <dd>Delete route <em>&lt;route-name&gt;</em>.</dd>
            <dt><code>oc create -f &lt;route-config-file.json&gt;.</code></dt>
            <dd>Create a route based on the configuration in the file <em>&lt;route-config-file.json&gt;</em>.</dd>
          </dl>
        </div>
        <h3>Example of a route config file</h3>
        <div>
          <pre class="code">
            {
              "apiVersion": "route.openshift.io/v1",
              "kind": "Route",
              "metadata": {
                  "creationTimestamp": "2019-07-12T11:02:19Z",
                  "labels": {
                      "app": "web"
                  },
                  "name": "post-op",
                  "namespace": "&lt;project-name&gt;",
                  "resourceVersion": "20724155",
                  "selfLink": "/apis/route.openshift.io/v1/namespaces/&lt;project-name&gt;/routes/&lt;route-name&gt;",
                  "uid": "8440defc-a494-11e9-a858-fa163eed8e5c"
              },
              "spec": {
                  "host": "&lt;hostname&gt;",
                  "port": {
                      "targetPort": "8080-tcp"
                  },
                  "tls": {
                      "caCertificate": "-----BEGIN CERTIFICATE-----&lt;ommited&gt;-----END CERTIFICATE-----",
                      "certificate": "-----BEGIN CERTIFICATE-----&lt;ommited&gt;-----END CERTIFICATE-----",
                      "insecureEdgeTerminationPolicy": "Redirect",
                      "key": "-----BEGIN PRIVATE KEY-----&lt;ommited&gt;-----END PRIVATE KEY-----",
                      "termination": "edge"
                  },
                  "to": {
                      "kind": "Service",
                      "name": "web",
                      "weight": 100
                  },
                  "wildcardPolicy": "None"
              },
              "status": {
                  "ingress": [
                      {
                          "conditions": [
                              {
                                  "lastTransitionTime": "2019-07-12T11:02:19Z",
                                  "status": "True",
                                  "type": "Admitted"
                              }
                          ],
                          "host": "&lt;hostname&gt;",
                          "routerName": "router-public",
                          "wildcardPolicy": "None"
                      }
                  ]
              }
          }
        </pre>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Secrets</h2>
        <div class="card-text">
          <p>Secrets can be configured locally in a yaml file:</p>
          <code class="code-block">
apiVersion: v1
kind: Secret
metadata:
  name: test-secret [1]
  namespace: my-namespace [2]
type: Opaque 
data: [3]
  username: dmFsdWUtMQ0K 
  password: dmFsdWUtMg0KDQo=
stringData: [4] 
  hostname: myapp.mydomain.com 
          </code>
          <dl>
            <dt>[1]</dt>
            <dd>Name of the secret</dd>
            <dt>[2]</dt>
            <dd>Name of the project</dd>
            <dt>[3]</dt>
            <dd>Values in the data section must be Base64 encoded.</dd>
            <dt>[4]</dt>
            <dd>Values in the stringData-section are converted to Base64 and then moved to the data section automatically.</dd>
          </dl>
          <p>With the project selected the secret can then be added to it with this command: <code>oc create -f secrets.yaml</code></p>
          <h3 class="card-title">Using secrets in configuration</h3>
          <p>A secret can be used in a pod or cron configuration. It has to be specifically referenced however.</p>
          <code class="code-block">
apiVersion: v1
kind: Pod
metadata:
  name: secret-example-pod
spec:
  containers:
    - name: secret-test-container
      image: busybox
      command: [ "/bin/sh", "-c", "export" ]
      env:
        - name: TEST_SECRET_USERNAME_ENV_VAR [1]
          valueFrom:
            secretKeyRef:
              name: test-secret [2]
              key: username [3]
  restartPolicy: Never             
          </code>
          <dl>
              <dt>[1]</dt>
              <dd>Name of the environment variable inside the pod</dd>
              <dt>[2]</dt>
              <dd>Name of the secret. This has to be the same name as is used in the secret.yaml's metadata-section.</dd>
              <dt>[3]</dt>
              <dd>The secrets' key to use.</dd>
            </dl>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
